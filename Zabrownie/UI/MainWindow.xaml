<Window x:Class="Zabrownie.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
        Title="Zabrownie"
        Height="800"
        Width="1200"
        Loaded="Window_Loaded"
        Closing="Window_Closing"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResize">

    <Window.Resources>
        <!-- Colores principales -->
        <SolidColorBrush x:Key="BgPrimary"
                         Color="#1A1A1D"/>
        <SolidColorBrush x:Key="BgSecondary"
                         Color="#25252A"/>
        <SolidColorBrush x:Key="BgTertiary"
                         Color="#2D2D35"/>
        <SolidColorBrush x:Key="AccentColor"
                         Color="#8B5CF6"/>
        <SolidColorBrush x:Key="AccentHover"
                         Color="#A78BFA"/>
        <SolidColorBrush x:Key="TextPrimary"
                         Color="#FFFFFF"/>
        <SolidColorBrush x:Key="TextSecondary"
                         Color="#A0A0A8"/>
        <SolidColorBrush x:Key="BorderColor"
                         Color="#3A3A45"/>

        <!-- Opera GX style ScrollBar -->
        <Style x:Key="OperaGXScrollBar"
               TargetType="ScrollBar">
            <Setter Property="Width"
                    Value="10"/>
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid x:Name="Root"
                              Background="Transparent">
                            <Track x:Name="PART_Track"
                                   IsDirectionReversed="True">
                                <!-- Invisible buttons (disable arrows) -->
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.LineUpCommand"
                                                  Opacity="0"/>
                                </Track.DecreaseRepeatButton>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="ScrollBar.LineDownCommand"
                                                  Opacity="0"/>
                                </Track.IncreaseRepeatButton>

                                <!-- The oval thumb -->
                                <Track.Thumb>
                                    <Thumb>
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border x:Name="ThumbBorder"
                                                        Width="6"
                                                        Margin="2"
                                                        Background="{StaticResource AccentColor}"
                                                        CornerRadius="10"
                                                        Opacity="0.7"/>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver"
                                                             Value="True">
                                                        <Setter TargetName="ThumbBorder"
                                                                Property="Opacity"
                                                                Value="0.9"/>
                                                    </Trigger>
                                                    <Trigger Property="IsDragging"
                                                             Value="True">
                                                        <Setter TargetName="ThumbBorder"
                                                                Property="Opacity"
                                                                Value="1"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="OperaGXScrollViewer"
               TargetType="ScrollViewer">
            <Setter Property="VerticalScrollBarVisibility"
                    Value="Auto"/>
            <Setter Property="HorizontalScrollBarVisibility"
                    Value="Disabled"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <ScrollContentPresenter Grid.Column="0"/>

                            <ScrollBar Grid.Column="1"
                                       Orientation="Vertical"
                                       Value="{TemplateBinding VerticalOffset}"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                       Style="{StaticResource OperaGXScrollBar}"/>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


        <!-- Estilo para tabs -->
        <Style x:Key="TabButtonStyle"
               TargetType="Button">
            <Setter Property="Background"
                    Value="{StaticResource BgSecondary}"/>
            <Setter Property="Foreground"
                    Value="{StaticResource TextSecondary}"/>
            <Setter Property="BorderBrush"
                    Value="Transparent"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Padding"
                    Value="16,8"/>
            <Setter Property="Margin"
                    Value="4,0,0,0"/>
            <Setter Property="FontSize"
                    Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="8,8,0,0"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"
                                              Margin="{TemplateBinding Padding}"/>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Border"
                                        Property="Background"
                                        Value="{StaticResource BgTertiary}"/>
                            </Trigger>

                            <DataTrigger Binding="{Binding IsActive}"
                                         Value="True">
                                <Setter Property="Foreground"
                                        Value="{StaticResource TextPrimary}"/>
                                <Setter TargetName="Border"
                                        Property="Background"
                                        Value="{StaticResource BgTertiary}"/>
                                <Setter TargetName="Border"
                                        Property="BorderBrush"
                                        Value="{StaticResource AccentColor}"/>
                                <Setter TargetName="Border"
                                        Property="BorderThickness"
                                        Value="0,2,0,0"/>
                            </DataTrigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para botones de navegaciÃ³n -->
        <Style x:Key="NavButtonStyle"
               TargetType="Button">
            <Setter Property="Background"
                    Value="Transparent"/>
            <Setter Property="Foreground"
                    Value="{StaticResource TextSecondary}"/>
            <Setter Property="BorderThickness"
                    Value="0"/>
            <Setter Property="Width"
                    Value="40"/>
            <Setter Property="Height"
                    Value="40"/>
            <Setter Property="FontSize"
                    Value="16"/>
            <Setter Property="Cursor"
                    Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"/>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Border"
                                        Property="Background"
                                        Value="{StaticResource BgTertiary}"/>
                                <Setter Property="Foreground"
                                        Value="{StaticResource TextPrimary}"/>
                            </Trigger>
                            <Trigger Property="IsPressed"
                                     Value="True">
                                <Setter TargetName="Border"
                                        Property="Background"
                                        Value="{StaticResource BorderColor}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled"
                                     Value="False">
                                <Setter Property="Opacity"
                                        Value="0.3"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Estilo para botones de acciÃ³n -->
        <Style x:Key="ActionButtonStyle"
               TargetType="Button"
               BasedOn="{StaticResource NavButtonStyle}">
            <Setter Property="Background"
                    Value="{StaticResource AccentColor}"/>
            <Setter Property="Foreground"
                    Value="{StaticResource TextPrimary}"/>
            <Setter Property="Width"
                    Value="Auto"/>
            <Setter Property="Padding"
                    Value="16,8"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="Border"
                                Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                SnapsToDevicePixels="True">
                            <ContentPresenter HorizontalAlignment="Center"
                                              VerticalAlignment="Center"
                                              Margin="{TemplateBinding Padding}"/>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver"
                                     Value="True">
                                <Setter TargetName="Border"
                                        Property="Background"
                                        Value="{StaticResource AccentHover}"/>
                            </Trigger>
                            <Trigger Property="IsPressed"
                                     Value="True">
                                <Setter TargetName="Border"
                                        Property="Opacity"
                                        Value="0.8"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <!-- Border exterior con sombra -->
    <Border Background="{StaticResource BgPrimary}"
            CornerRadius="12"
            BorderThickness="1"
            BorderBrush="{StaticResource BorderColor}">
        <Border.Effect>
            <DropShadowEffect Color="Black"
                              Direction="270"
                              ShadowDepth="0"
                              BlurRadius="20"
                              Opacity="0.8"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Barra de tÃ­tulo y tabs -->
            <Border Grid.Row="0"
                    Background="{StaticResource BgSecondary}"
                    CornerRadius="12,12,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Height="45">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Logo -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                Margin="16,0,12,0"
                                VerticalAlignment="Center">
                        <TextBlock Text="Z"
                                   FontSize="20"
                                   FontWeight="Bold"
                                   Foreground="{StaticResource AccentColor}"
                                   Margin="0,0,4,0"/>
                        <TextBlock Text="abrownie"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimary}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- Tabs -->
                    <Border Grid.Column="1"
                            MouseLeftButtonDown="StopDrag">
                        <ScrollViewer 
                            Style="{StaticResource OperaGXScrollViewer}"
                            HorizontalScrollBarVisibility="Auto"
                            VerticalScrollBarVisibility="Disabled">
                            <ItemsControl x:Name="TabsControl"
                                          ItemsSource="{Binding}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal"/>
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Button Style="{StaticResource TabButtonStyle}"
                                                Click="Tab_Click"
                                                Tag="{Binding}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding Title}"
                                                           MaxWidth="150"
                                                           TextTrimming="CharacterEllipsis"
                                                           VerticalAlignment="Center"
                                                           Margin="0,0,12,0"/>
                                                <Button Grid.Column="1"
                                                        Content="âœ•"
                                                        Width="18"
                                                        Height="18"
                                                        FontSize="10"
                                                        Padding="0"
                                                        Click="CloseTab_Click"
                                                        Tag="{Binding}"
                                                        Foreground="{StaticResource TextSecondary}"
                                                        Background="Transparent"
                                                        BorderThickness="0"
                                                        Cursor="Hand">
                                                    <Button.Style>
                                                        <Style TargetType="Button">
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="Button">
                                                                        <Border Background="{TemplateBinding Background}"
                                                                                CornerRadius="4">
                                                                            <ContentPresenter HorizontalAlignment="Center"
                                                                                              VerticalAlignment="Center"/>
                                                                        </Border>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                            <Style.Triggers>
                                                                <Trigger Property="IsMouseOver"
                                                                         Value="True">
                                                                    <Setter Property="Background"
                                                                            Value="#FF3A3A"/>
                                                                    <Setter Property="Foreground"
                                                                            Value="White"/>
                                                                </Trigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Button.Style>
                                                </Button>
                                            </Grid>
                                        </Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>
                    </Border>

                    <!-- New Tab Button -->
                    <Button Grid.Column="2"
                            Content="+"
                            Style="{StaticResource NavButtonStyle}"
                            Click="NewTab_Click"
                            FontSize="18"
                            FontWeight="Bold"
                            Margin="4,0"
                            MouseLeftButtonDown="StopDrag"/>

                    <!-- Window Controls -->
                    <StackPanel Grid.Column="3"
                                Orientation="Horizontal"
                                MouseLeftButtonDown="StopDrag"
                                Margin="8,0,8,0">
                        <Button Content="â€”"
                                Width="40"
                                Height="40"
                                Click="Minimize_Click"
                                Style="{StaticResource NavButtonStyle}"/>
                        <Button Content="â–¢"
                                Width="40"
                                Height="40"
                                Click="Maximize_Click"
                                Style="{StaticResource NavButtonStyle}"
                                Margin="4,0,0,0"/>
                        <Button Content="âœ•"
                                Width="40"
                                Height="40"
                                Click="Close_Click"
                                Foreground="{StaticResource TextSecondary}"
                                Margin="4,0,0,0">
                            <Button.Style>
                                <Style TargetType="Button"
                                       BasedOn="{StaticResource NavButtonStyle}">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver"
                                                 Value="True">
                                            <Setter Property="Background"
                                                    Value="#FF3A3A"/>
                                            <Setter Property="Foreground"
                                                    Value="White"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Barra de navegaciÃ³n -->
            <Border Grid.Row="1"
                    Background="{StaticResource BgPrimary}"
                    Padding="12,12">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Column="0"
                            Content="â—„"
                            x:Name="BackButton"
                            Style="{StaticResource NavButtonStyle}"
                            Click="BackButton_Click"
                            ToolTip="AtrÃ¡s"
                            Margin="0,0,4,0"/>

                    <Button Grid.Column="1"
                            Content="â–º"
                            x:Name="ForwardButton"
                            Style="{StaticResource NavButtonStyle}"
                            Click="ForwardButton_Click"
                            ToolTip="Adelante"
                            Margin="0,0,4,0"/>

                    <Button Grid.Column="2"
                            Content="âŸ³"
                            Style="{StaticResource NavButtonStyle}"
                            Click="ReloadButton_Click"
                            ToolTip="Recargar"
                            Margin="0,0,12,0"/>

                    <!-- AddressBar -->
                    <Border Grid.Column="3"
                            Background="{StaticResource BgSecondary}"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Height="40">
                        <TextBox x:Name="AddressBar"
                                 VerticalContentAlignment="Center"
                                 Padding="16,0"
                                 FontSize="14"
                                 Foreground="{StaticResource TextPrimary}"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 CaretBrush="{StaticResource AccentColor}"
                                 KeyDown="AddressBar_KeyDown"
                                 GotFocus="AddressBar_GotFocus"
                                 Text="Escribe URL o busca..."/>
                    </Border>

                    <Button Grid.Column="4"
                            Content="Ir"
                            Style="{StaticResource ActionButtonStyle}"
                            Click="GoButton_Click"
                            Margin="8,0"/>

                    <Button Grid.Column="5"
                            x:Name="BookmarkButton"
                            Content="â˜†"
                            Style="{StaticResource NavButtonStyle}"
                            Click="BookmarkButton_Click"
                            FontSize="18"
                            ToolTip="Marcar esta pÃ¡gina"
                            Margin="0,0,4,0"/>

                    <Button Grid.Column="6"
                            Content="ðŸ”–"
                            FontWeight="Bold"
                            Style="{StaticResource NavButtonStyle}"
                            Click="ManageBookmarks_Click"
                            ToolTip="Gestionar marcadores"
                            Margin="0,0,4,0"/>

                    <Button Grid.Column="7"
                            Content="âš™"
                            Style="{StaticResource NavButtonStyle}"
                            Click="SettingsButton_Click"
                            ToolTip="ConfiguraciÃ³n"/>
                </Grid>
            </Border>

            <!-- Barra de marcadores -->
            <Border Grid.Row="2"
                    x:Name="BookmarksBar"
                    Background="{StaticResource BgSecondary}"
                    BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="0,1,0,0"
                    Padding="12,8"
                    Visibility="Collapsed">
                <ScrollViewer
                    Style="{StaticResource OperaGXScrollViewer}"
                    HorizontalScrollBarVisibility="Auto"
                    VerticalScrollBarVisibility="Disabled">
                    <ItemsControl x:Name="BookmarksBarControl">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Content="{Binding Title}"
                                        Tag="{Binding Url}"
                                        Click="BookmarkBarItem_Click"
                                        Style="{StaticResource NavButtonStyle}"
                                        Width="Auto"
                                        Padding="12,6"
                                        Margin="0,0,4,0"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>

            <!-- Contenedor del WebView con notificaciÃ³n -->
            <Grid Grid.Row="3"
                  Background="{StaticResource BgPrimary}">
                <Grid x:Name="WebViewContainer"/>

                <!-- NotificaciÃ³n flotante -->
                <Border x:Name="StatusNotification"
                        Background="{StaticResource BgSecondary}"
                        BorderBrush="{StaticResource AccentColor}"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="12,8"
                        Margin="16"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Bottom"
                        Visibility="Collapsed">
                    <Border.Effect>
                        <DropShadowEffect Color="Black"
                                          Direction="270"
                                          ShadowDepth="0"
                                          BlurRadius="10"
                                          Opacity="0.5"/>
                    </Border.Effect>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock x:Name="StatusText"
                                   Foreground="{StaticResource TextPrimary}"
                                   FontSize="12"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Border>
            </Grid>
            <Rectangle
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Width="16"
                Height="16"
                Cursor="SizeNWSE"
                Fill="Transparent"
                MouseDown="ResizeGrip_MouseDown"/>
        </Grid>
    </Border>
</Window>